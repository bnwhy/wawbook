Créer un projet Node.js sur Replit avec les fonctionnalités suivantes :

1️⃣ Dépendances à installer :
- "express" pour le serveur HTTP
- "playwright" pour le rendu headless Chromium
- "cheerio" pour parser et modifier le HTML
- "jszip" pour décompresser les fichiers EPUB
- "@aws-sdk/client-s3" pour lire/écrire sur un bucket S3 ou Object Storage
- "sharp" pour compresser/redimensionner les images JPEG
- "p-queue" pour gérer les lots et la génération massive de previews

2️⃣ Préchargement du EPUB master (moteur persistant) :
- Lire un EPUB template depuis un bucket ou stockage local au démarrage
- Décompresser le EPUB avec JSZip et extraire :
  • HTML/XHTML des pages
  • CSS combiné en un fichier unique
  • Polices converties en Data URIs (Base64)
  • Images (URLs permanentes ou locales)
- Charger toutes les pages HTML/XHTML et assets en mémoire pour réutilisation
- Lancer Chromium/Playwright headless au démarrage et le garder ouvert pour toutes les générations

3️⃣ Endpoint pour génération de previews :
POST /api/books/:id/generate-previews
- Reçoit un JSON contenant :
  • userId
  • variables personnalisées (nom, âge, dédicace, images)
- Pour chaque page du template en mémoire :
  1. Copier le HTML en mémoire
  2. Injecter les variables dans le HTML via Cheerio
  3. Mapper les images vers leurs URLs permanentes
  4. Rendre chaque page en JPEG avec Playwright
  5. Compresser le JPEG avec Sharp si nécessaire
  6. Uploader le JPEG vers le bucket / Object Storage
- Retourne un JSON listant les URLs des previews générées pour le client

4️⃣ Optimisations :
- Réutiliser le moteur et Chromium/Playwright pour tous les clients
- Utiliser p-queue pour gérer les requêtes massives et limiter le nombre d’instances Playwright simultanées
- Servir les assets fixes via un serveur statique temporaire si nécessaire
- Stocker en mémoire ou sur disque temporaire les pages HTML modifiées pour accélérer le batch

5️⃣ Exemple minimal :
- Ajouter un README expliquant :
  • Comment démarrer le serveur
  • Comment tester l’endpoint POST avec un exemple de JSON
  • Comment récupérer les previews JPEG pour affichage avec un flipbook
